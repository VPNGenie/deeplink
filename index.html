<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Deep Link Redirect</title>
</head>
<body>
  <h2>Если переход не сработал, нажмите на ссылку:</h2>
  <p id="link"></p>

<script>
function base64DecodeUnicode(str) {
  return decodeURIComponent(Array.prototype.map.call(atob(str), c => {
    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
  }).join(''));
}

(async () => {
  const params = new URLSearchParams(window.location.search);
  const encoded = params.get('cfg'); // URL-safe Base64

  if (!encoded) {
    document.getElementById('link').textContent = "Параметр cfg не указан.";
    return;
  }

  try {
    const cfg = base64DecodeUnicode(decodeURIComponent(encoded));

    // Автоматический редирект
    window.location.href = cfg;

    // Фоллбэк ссылка
    const linkContainer = document.getElementById('link');
    const a = document.createElement('a');
    a.href = cfg;
    a.textContent = "Открыть вручную";
    a.style.fontSize = "20px";
    a.style.color = "#007bff";
    linkContainer.appendChild(a);

  } catch(e) {
    console.error(e);
    document.getElementById('link').textContent = "Ошибка декодирования cfg";
  }
})();
</script>
</body>
</html>
